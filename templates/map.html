<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Weekend Wanderlust</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>

    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />

<style>
    body { margin:0; 
           padding:0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #categories {
    position: absolute;
    top: 0;
    right: 0;
    background: #fff;
    width: 200px;
    padding:5px;
    }

    .label {
    position: absolute;     
    width: 315px;
    height: 22px;
/*    left: 10px;
*/    top: 21px;
    color: white; 
    text-align: center;
    padding-top: 8px;
    margin-left: 5%;
    font-size: 14px;
    }

    .disable {
      display: none;
    }

    #gems,
    #start,
    #explorer {
    background-color: #33cccc;
    margin-left: 4%;
    width:300px;
    font-family: 'Nunito', sans-serif;  
    font-weight: 300;
    }

    body .ui {
    width:300px;
    background:rgba(0,0,0,0.5);
    font-family: 'Nunito', sans-serif;
    position:absolute;
    bottom:20px;
/*    left:10px;
*/  /*  padding:5px 10px; */  
    color:#fff;
    font-size:11px;
    line-height:18px;
/*    border-radius:3px;*/    
    max-height:90%;
    overflow: auto;
    margin-left: 4%;
    box-shadow: none;
    z-index: 0;
    }

    body .ui .drop {
      z-index: -3;
      opacity: 0;
      width: 240px;
      height: 10px;
      background-color: #3d3d3d;
      position: absolute;
      color: white;
      bottom: 0;
      padding: 12px 30px 21px 30px;
      -webkit-transition-property: bottom, opacity;
      transition-property: bottom, opacity;
      -webkit-transition-duration: .3s;
      transition-duration: .3s;
    }

    body .ui_box .drop p {
      color: white;
    }

    body .ui_box {
      top: -6px;
      bottom: 0;
      z-index: 1;
      width: 300px;
      height: auto;
/*      margin-left: 4%;
*/      position: relative;
      background: rgba(0,0,0,0.5);
      float: left; 
      box-shadow: -1px 0px rgba(255, 255, 255, 0.07);
      cursor: pointer;
      -webkit-transform: scale(1);
      transform: scale(1);
      -webkit-transition-property: background,-webkit-transform;
      transition-property: transform, background;
      transition-property: transform, background, -webkit-transform;
      -webkit-transition-duration: .3s;
      transition-duration: .3s;    
    }

    body .ui_box__inner {
      padding: 25px;
    }

    body .ui_box__inner p {
      padding: 5px;
      margin: 10px;
    }

    body .ui_box p {
      font-size: 11px;
      color: #b6b6b6;
      clear: left;
      font-weight: 300;
      width: 220px;
      margin: 0px 0px 0px 0px;
    }

    body .ui_box:hover {
      background: #3d3d3d;
/*      background: rgba(255, 255, 255, 0.07);
*/      -webkit-transform: scale(1.05);
      transform: scale(1.05);
      -webkit-transition-property: background, -webkit-transform;
      transition-property: background, -webkit-transform;
      transition-property: transform, background;
      transition-property: transform, background, -webkit-transform;
      -webkit-transition-duration: .3s;
      transition-duration: .3s;
      position: relative;
      z-index: 20;
    }

    .ui_box:hover > .ui_box__inner p {
      color: white;
    }

    .ui_box:hover > .drop {
      -webkit-transition-property: bottom, opacity;
      transition-property: bottom, opacity;
      -webkit-transition-duration: .3s;
      transition-duration: .3s;
      bottom: -42px;
      opacity: 1;
      background-color: #33cccc;
    }

    .ui_box:hover > .drop .arrow {
      -webkit-transition-property: -webkit-transform;
      transition-property: -webkit-transform;
      transition-property: transform;
      transition-property: transform, -webkit-transform;
      -webkit-transition-duration: 1s;
      transition-duration: 1s;
      -webkit-transform: rotate(765deg);
      transform: rotate(765deg);
    }

    .arrow {
      width: 4px;
      height: 4px;
      -webkit-transition-property: -webkit-transform;
      transition-property: -webkit-transform;
      transition-property: transform;
      transition-property: transform, -webkit-transform;
      -webkit-transition-duration: 1s;
      transition-duration: 1s;
      -webkit-transform: rotate(45deg);
      transform: rotate(45deg);
      -webkit-transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55);
      border-top: 1px solid #CDEAD3;
      border-right: 1px solid #CDEAD3;
      float: right;
      position: relative;
      top: -11px;
      right: 0px;
    }

/*  .listCard {
    margin-top: -2px;
    }
*/
/*  .hover {
    background: rgba(0,0,0,0.3);
  }
*/
  #popupimg {
    width: 100%;
  }

  .listImg {
    width: 100%;
    height: auto;
    margin-top: -6px;
  }

  #container {
    width: 300px;
    vertical-align: middle;
  }

  #container img {
    width: 100%;
    height: auto;
  }

  #container p {
    padding-left: 15px;
    padding-right: 15px;
    display: inline-block;
    white-space: normal;
    font-size: 12px;
  }

  #container button {
    padding-left: 10px;
    padding-right: 10px;
    margin-top: 5px;
    margin-bottom: 5px;
  }

 div {
    font-family: 'Nunito', sans-serif;  
    font-weight: 300;
  }

  #addToTrip {
/*    margin: 10px;
*/  }

  .menu-ui {
  background:#fff;
  position:absolute;
  top:10px;right:10px;
  z-index:1;
  border-radius:3px;
  width:15%;
  border:1px solid rgba(0,0,0,0.4);
  }
  .menu-ui a {
    font-size:13px;
    color:#404040;
    display:block;
    margin:0;padding:0;
    padding:10px;
    text-decoration:none;
    border-bottom:1px solid rgba(0,0,0,0.25);
    text-align:center;
    }
    .menu-ui a:first-child {
      border-radius:3px 3px 0 0;
      }
    .menu-ui a:last-child {
      border:none;
      border-radius:0 0 3px 3px;
      }
    .menu-ui a:hover {
      background:#f8f8f8;
      color:#404040;
      }
    .menu-ui a.active,
    .menu-ui a.active:hover {
      background:#33cccc;
      color:#FFF;
      }

    #trip-panel, .flip {
      position: absolute;
      width: 20%;
      background:rgba(0,0,0,0.8);
      color: white;
      right: 10px; bottom: 20px;
      overflow: auto;
      margin: 0;
      padding: 2%;
      max-height: 80%;
      font-family: 'Nunito', sans-serif;  
      font-weight: 300;
      font-size: 12px;
    }

    #trip-panel {
      display: none;
    }

    #waypoint-list {

    }

    #waypoint-list li {
      padding: 5px;
      margin-left:20px;
/*      list-style-type: none;
*/    }

    #waypoint-list li:hover {
      background: rgba(0,0,0,0.5);
    }

    #trip-form {
      padding: 10px;
    }

    .hide {
      visibility: hidden;
    }

    .show {
      visibility: visible;
    }

    .inline {
      display: inline;
    }

/*    .sidebar {
      width: 33.3333%;
    }
*/
    .pad2 {
/*      padding: 20px;
*/      background: rgba(255,255,255,.5);
      border-style: hidden;
      -webkit-box-sizing:border-box;
      -moz-box-sizing:border-box;
          box-sizing:border-box;
    }

    #close {
      float: right;
      display: inline-block;
      padding: 2px 5px;
      color: white;
    }

    .box {
      padding: 5px;
    }

    #verticalbar {
      list-style-type: none;
      margin: 0;
      padding: 0;
      width: 3%;
      background: rgba(0,0,0,.9);
      height: 100%;
      position: fixed;
      overflow: auto;
      z-index: 100;
      visibility: hidden;
    }

    #popupButton {
      background-color: white;
      border: 2px solid #33cccc;
      color: #33cccc;
      padding: 8px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 12px;
      margin-top: 8px;
      margin-bottom: 2px;
      cursor: pointer;
    }

    #popupButton:hover {
      background-color: #33cccc;
      color: white;
      border: 2px solid #33cccc;
    }

    
    </style>
</head>
<body>

<ul id="verticalbar">
  <li><a href="#">Home</a></li>
  <li><a href="#">Blog</a></li>
  <li><a href="#">Contact</a></li>
  <li><a href="#">About</a></li>
</ul>

<div class='sidebar pad2'>
<nav id='menu-ui' class='menu-ui pad2'>
    <a href='#' class='active' id='filter-all'>All Weekend</a>
    <a href='#' id='filter-friday'>Friday Night</a>
    <a href='#' id='filter-saturday'>Saturday</a>
    <a href='#' id='filter-sunday'>Sunday</a>
</nav>
</div>

<div id='map'></div>

<div class='label' id='start'>Click an event to uncover hiddengems</div>
<div class='label hide' id='gems'><b><span id="counter"></span></b> hiddengems within 1 mile</div>
<div class='label hide' id='explorer'><b>Explorer circle</b></div>

<!-- Info box with scroll spy -->
<div id='coordinates' class='ui' data-spy="scroll" data-target="#myScrollspy" data-offset="20"></div>

<p class="flip" onclick="openPanel()">Click to open Trip Panel</p>
<div id="trip-panel">
  <span id="close" onclick="closePanel()">x</span>
  <p>Trip Planner Panel</p><br> 
  <div><b>Selected waypoints:</b>
    <ol id='waypoint-list'></ol></div>
  <b>Selected travel profile: </b><div id="selected-profile" class="inline"></div><br>
  <div>
    <b>Distance: </b><div id="distance" class="inline"></div><br>
    <b>Estimated time: </b><div id="duration" class="inline"></div><br>
  </div>
  <div id='status'></div><br>
  <form action="/get_profile">
    Way of traveling:<br>
    <input type="radio" name="profile" value="walking">Walking
    <input type="radio" name="profile" value="cycling">Cycling
    <input type="radio" name="profile" value="driving">Driving<br>
  </form><br>

  <button id="get-route">Show route</button>
  <button id="clear-route">Clear route</button>
  <button id="clear-session">Clear session</button><br>

  <button id="show-circle">1 mile circle</button>
  <button id="remove-circle">remove circle</button> 
  <button id="save-trip">Save trip</button>
</div> 

<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//cdn.jsdelivr.net/jquery.scrollto/2.1.2/jquery.scrollTo.min.js"></script>
<script>

    function openPanel() {
      document.getElementById('trip-panel').style.display = "block";
    }

    function closePanel() {
      document.getElementById('trip-panel').style.display = "none";
    }

    // open panel to show more info from Yell/Foursquare api
    function openMoreInfoPanel() {
      // to be developed
    }

    // load mapbox public access token.
    L.mapbox.accessToken = 'pk.eyJ1IjoidGVycml3bGVlIiwiYSI6ImNpazZlaThsajAwcXdpMm0ycHUyZjhiYjkifQ.zvJK8nAc3HpNOtCAMh5QlQ';

    // load base map, set initial position, add search controller.
    var map = L.mapbox.map('map', 'mapbox.streets')
        .setView([37.71, -122.327], 10)
        .addControl(L.mapbox.geocoderControl('mapbox.places')); //search

    // add event layer to map and load event markers geojson.
    var eventLayer = L.mapbox.featureLayer().addTo(map);
    eventLayer.loadURL('/events.geojson');

    // create hiddengemLayer, load geojson, but not add to map just yet.
    var hiddengemLayer = L.mapbox.featureLayer().loadURL('/hiddengems.geojson');

    // when click on any event marker, zoom in and show nearby hiddengems
    eventLayer.on('click', function(e) {
        map.setView(e.latlng, 13);
        map.panTo(e.latlng);
        hiddengemLayer.addTo(map);
        showWithin(e);
        countWithin(e);
        showInView();
        document.getElementById('gems').className = "label show";
      });

    // when click on hiddengem marker, zoom in, center and show info.
    hiddengemLayer.on('click', function(e) {
      map.setView(e.latlng, 14);
      map.panTo(e.latlng);
      showInView();
      var id = e.layer.feature.id;
      console.log(id);
      $('#coordinates').scrollTo('#'+ id, {duration: 'slow'});
    });

    // hiddengemLayer.on('click', function(e) {
    //   showInView();
    //   var id = e.layer.feature.id
    //   $('#coordinates').scrollTo('#'+ id);
    // });


    // define the 1 mile radius circle for showWithin
    var RADIUS = 1610;
    var filterCircle_options = {
          color: "#33cccc",
          opacity: 1,
          weight: 1.5,
          fillOpacity: 0.1
        };
    var filterCircle = L.circle([0,0], RADIUS, filterCircle_options).addTo(map);


    // intend to add draggable marker to circle center, under development
    // function addDraggableMarker(e) {
    //   var marker = L.marker(new L.LatLng(e.latlng), {
    //     icon: L.mapbox.marker.icon({
    //       'marker-color': 'ff8888'
    //     }),
    //     draggable: true
    //   });
    // }


    // function to count hiddengems within radius circle
    function countWithin(e) {
      var counter = 0;
      hiddengemLayer.eachLayer(function(marker) {
        if (e.latlng.distanceTo(L.latLng(
          marker.feature.geometry.coordinates[1], marker.feature.geometry.coordinates[0])) < RADIUS) {
          counter += 1;
        }
      });
      document.getElementById('counter').innerHTML = counter;
    }

    // function to show hiddengems within radius circle
    function showWithin(e) {
      filterCircle.setLatLng(e.latlng);
      hiddengemLayer.addTo(map);
      hiddengemLayer.setFilter(function showGems(feature) {
        return e.latlng.distanceTo(L.latLng(
          feature.geometry.coordinates[1],
          feature.geometry.coordinates[0])) < RADIUS;
      });
    }

    // given an address and showWithin
    map.on('click', function() {
      showWithin();
      countWithin();
    });


    //  Explorer mode: 1 mile radius circle on mousemove
    $('#show-circle').on('click', function() {
      map.on('mousemove', function(e) {
        showWithin(e);
        countWithin(e);
      });
      map.on('click', function(e) {
        showWithin(e);
        countWithin(e);
      });
      document.getElementById('explorer').className = "label show";
      document.getElementById('gems').className = "label hide";

    });

    // remove mousemove and reset filterCircle
    $('#remove-circle').on('click', function() {
      filterCircle.setLatLng([0,0]);
      map.off("mousemove");
      map.off("click");
      hiddengemLayer.setFilter(function showWithin(feature) {
        return true;
      });
      console.log("Finished remove filterCircle");
    });

    // experiment no success, used another approach to achieve goal, try later.
    // $('#turf-buffer').on('click', function() {
    //   map.on('click', function(e) {
    //     // var t = e.latlng;
    //     // // console.log(t);
    //     // var lat = t.lat;
    //     // var lng = t.lng;
    //     var pt = turf.point([37.748457761603355, -122.4326705932617], {
    //         "description": "explorer",
    //         "marker-color": "#6BC65F",
    //         "marker-size": "large",
    //         "marker-symbol": "pitch"
    //       });
    //     var ptLayer = L.mapbox.featureLayer().addTo(map);
    //     ptLayer.setGeoJSON(pt);
    //     console.log(pt);

        
    //     var bufferLayer = L.mapbox.featureLayer().addTo(map);

    //     ptLayer.eachLayer(function(layer) {
    //       layer.options.draggable = true;
    //       layer.on('drag', function(e) {
    //         calculateBuffer();
    //       });
    //     });

    //     function calculateBuffer() {
    //       var pt = turf.featurecollection(ptLayer.getLayers().map(function(f) {
    //         return f.toGeoJSON()
    //       }));
    //       // console.log(pt);
    //       var buffer = turf.buffer(pt, 1, 'miles');
    //       beffer.properties = {
    //         "fill": "#6BC65F",
    //         "stroke": "#25561F",
    //         "stroke-width": 2
    //       };
    //       befferLayer.setGeoJSON(buffer);
    //     }
    //     // var pt = {
    //     //   "type": "Feature",
    //     //   "properties": {
    //     //     "marker-color": "#6BC65F",
    //     //     "marker-size": "small"
    //     //   },
    //     //   "geometry": {
    //     //     "type": "Point",
    //     //     "coordinates": [lat, lng]
    //     //     }
    //     //   };
    //     // console.log(pt);
    //     var buffered = turf.buffer(pt, 100, 'miles');
    //     buffered.properties = {
    //       "fill": "#6BC65F",
    //       "stroke": "#25561F",
    //       "stroke-width": 2
    //     };
    //     // // console.log(buffered);
    //     var results = turf.featurecollection(buffered);
    //     console.log(results);
    //     // var bufferLayer = L.mapbox.featureLayer().addTo(map);
    //     // bufferLayer.setGeoJSON(results);
    //     // var bufferLayer = L.geoJson().addTo(map);
    //     // bufferLayer.addData(results);
    //     // bufferLayer.setStyle({
    //     //   "color": "#ff7800",
    //     //   "weight": 5,
    //     //   "opacity": 0.65 });
        
        
    //     // ptLayer.eachLayer(function(layer) {
    //     //   layer.options.draggable = true;
    //     //   layer.on('drag', function(e) {
    //     //     calculateBuffer();
    //       });
    //     });

    //     // ptLayer.addTo(map);
    //     // calculateBuffer();

    //   //   function calculateBuffer() {
    //   //     var pt = turf.featurecollection(ptLayer.getLayers().map(function(f) {
    //   //       return f.toGeoJSON()
    //   //     }));
    //   //   var buffer = turf.buffer(pt, 1, 'miles');
    //   //   buffer.properties = {
    //   //     "fill": "#6BC65F",
    //   //     "stroke": "#25561F",
    //   //     "stroke-width": 2
    //   //   };
    //   //   bufferLayer.setGeoJSON(buffer);
    //   //   }
    //   //   });
    //   // });
    
    //     // hiddengemLayer.setFilter(function showWithin(f) {
    //     //   return (e.layer.getLatLng()).distanceTo(
    //     //     f.geometry.coordinates[1],
    //     //     f.geometry.coordinates[0]) < RADIUS;
    //     // });
    //     // $.get('/hiddengems.geojson', showWithin);
    // //     var pt = {
    // //       "type": "Feature",
    // //       "properties": {},
    // //       "geometry": {
    // //         "type": "Point",
    // //         "coordinates": currentLatLng
    // //       }
    // //     };
    // //     var buffer = turf.butter(pt, 1, 'miles');
    // //     buffer.properties = {
    // //       "fill": "#6BC65F",
    // //       "stroke": "#25561F",
    // //       "stroke-width": 2
    // //     };
    // //     bufferLayer.setGeoJSON(buffer);
    // // }); 
 

    function showInView() {
      $('#coordinates').empty();
      var bounds = map.getBounds();

      hiddengemLayer.eachLayer(function(marker) {

        // check if marker is in view, if yes, construct contents to show in preview box
        if (bounds.contains(marker.getLatLng())) {
          var listContent = '<div><img id="' + marker.feature.id + '"class="listImg" src="' + marker.feature.properties.img_url + '" /><div class="ui_box"><div class="ui_box__inner" id="container" data-id="' + marker.feature.id + '"data-latlng="' + marker.feature.geometry.coordinates + '">' + '<p><b>' + marker.feature.properties.name + '</b><br>' + marker.feature.properties.description + '</p></div><div class="drop" onclick="openMoreInfoPanel()"><p>Take a closer look</p><div class="arrow"></div></div></div></div>';
            
          document.getElementById('coordinates').innerHTML += listContent;
        }
        
        // when mouseover preview box, dim the info box background and show corresponding marker
        $("#coordinates div").hover(
        function(){ // mouseenter
          // $(this).addClass("hover");
          var target = this.dataset.id;
          // console.log(target);
          hiddengemLayer.eachLayer(function(marker){
            // console.log(target);
            if (marker.feature.id == target) {
              marker.openPopup();
            }
          });
        }, 
        function(){ // mouseleave
          $(this).removeClass("hover");
        }); 
      });
    }


    // customize hiddengem popup content
    hiddengemLayer.on('layeradd', function(e) {
        var marker = e.layer,
            feature = marker.feature;

        var popupContent = '<b>' + feature.properties.name + '</b><br>' + feature.properties.address + '<br><form action="/add_waypoint"><input type="hidden" name="marker_id" onclick="openPanel()" value="' + feature.id + '"><button id="popupButton" class="trigger" onclick="openPanel()" data-id="' + feature.id + '" data-name="' + feature.properties.name + '">Add To Trip Panel</button></form>'; 
        
        marker.bindPopup(popupContent, {
            closeButton: true,
            minWidth: 120
            });
    });

    // customize event popup content
    eventLayer.on('layeradd', function(e) {
        var marker = e.layer,
            feature = marker.feature;

        var popupContent = '<b>' + feature.properties.title + '</b><br><small>' + feature.properties.date + ' | ' + feature.properties.time + '</small><br>' + feature.properties.description + '<br><div><small>Address: ' + feature.properties.address + '</small></div><form action="/add_waypoint"><input type="hidden" name="marker_id" value="' + feature.id + '"><button id="popupButton" class="trigger" onclick="openPanel()" data-id="' + feature.id + '" data-name="' + feature.properties.name + '">Add To Trip Panel</button></form>'; 
        
        marker.bindPopup(popupContent, {
            closeButton: true,
            minWidth: 120
            });
    });


    // show tooltips on mouseover onto event marker
    eventLayer.on('mouseover', function(e) {
        e.layer.openPopup();
    });

    hiddengemLayer.on('mouseover', function(e) {
        e.layer.openPopup();
    });

    // $(document).ready(function() {
    //   // add scrollspy to info box
    //   $('#coordinates').scrollspy({target: ""})

    // })


    // Toggling layers by event category
    var all = document.getElementById('filter-all');
    var friday = document.getElementById('filter-friday');
    var saturday = document.getElementById('filter-saturday');
    var sunday = document.getElementById('filter-sunday');

    friday.onclick = function(e) {
        all.className = '';
        saturday.className = '';
        sunday.className = '';
        this.className = 'active';
        eventLayer.setFilter(function(f) {
            return f.properties['date-tier'] === 'Friday Night';
        });
        return false;
    };

    saturday.onclick = function(e) {
        all.className = '';
        friday.className = '';
        sunday.className = '';
        this.className = 'active';
        eventLayer.setFilter(function(f) {
            return f.properties['date-tier'] === 'Saturday';
        });
        return false;
    };

    sunday.onclick = function(e) {
        all.className = '';
        friday.className = '';
        saturday.className = '';
        this.className = 'active';
        eventLayer.setFilter(function(f) {
            return f.properties['date-tier'] === 'Sunday';
        });
        return false;
    };

    all.onclick = function() {
        friday.className = '';
        saturday.className = '';
        sunday.className = '';
        this.className = 'active';
        eventLayer.setFilter(function(f) {
            return true;
        });
        return false;
    };

    // helper function to update the waypoint list
    function updateList(results) {
      var board = document.getElementById('waypoint-list');
      var info = '<li>' + results + '</li>';
      board.innerHTML += info;
    }

    // helper function to show "add to trip" status
    function showStatus(results) {
      var status = results;
      $('#status').html(status);
      console.log("Finished showStatus");
      if (status == "Waypoint added to trip!") {
        $.get('/update_waypoint_list', updateList);
        console.log("Finished update list");
      }
    }

    // helper function to update travel profile on planner panel
    function updateProfile(results) {
      var profile = results;
      $('#selected-profile').html(profile);
      console.log("Finished update profile")
    }

    
    var routeLayer = L.geoJson().addTo(map);
    
    // helper function to show route and details
    function showRoute(results) {
        // get LineString geojson
        var myLines = results.geometry;
        // add LineString to routeLayer
        routeLayer.addData(myLines);
        // style route
        routeLayer.setStyle({
          "color": "#ff7800",
          "weight": 5,
          "opacity": 0.65 });
        // console.log for debugging
        console.log("Finished add routeLayer");
        // zoom to route
        map.fitBounds(routeLayer.getBounds());
        // get distance (in meters) from api response
        var distance = (results.distance / 1609.34).toFixed(2);
        document.getElementById('distance').innerHTML = (distance + " miles");
        // get duration (in seconds) from api response
        var duration = Math.round(results.duration / 60);
        document.getElementById('duration').innerHTML = (duration + " mins");
        // console.log for debugging
        console.log("Finished show route");
      }


    // // experiment.
    // function addPath(results) {
    //   // console.log(results);
    //   var line_points = results.geometry;
    //   console.log(line_points);
    //   var polyline_options = {
    //     // stroke: true,
    //     color: 'red',
    //     weight: 5,
    //     opacity: 0.65,
    //     // fill: true,
    //     // lineJoin: "round",
    //     // lineCap: "round",
    //     // clickable: true,
    //     // className: "path"
    //   };
    //   var polyline = L.polyline(line_points, polyline_options).addTo(map);
    //   console.log(polyline);
    //   console.log("Finished add path");
    // };


    // On click "Add to trip" button in marker popup, check duplicate
    // and add to session, update status accordingly.
    // "Add to trip" button: the HTML doesn't exist yet, so we can't just say $('#mybutton'). Instead, we listen for click events on the map element which will bubble up from the tooltip, once it's created and someone clicks on it.
    $('#map').on('click', '.trigger', function (e){
      e.preventDefault();
      console.log(this.dataset.id);
      $.get('/add_waypoint', {'marker_id': this.dataset.id}, showStatus);
      console.log("Finished sending AJAX to add_waypoint");
    });


    // get or update travel profile by clicking radio button
    $('input[name$="profile"]').click(function() {
      var profile = $(this).val();
      $.get('/get_profile', {'profile': profile}, updateProfile);
    });


    // get directions using mapbox directions api
    $('#get-route').on('click', function(e) {
      e.preventDefault();
      $.get('/get_route', showRoute);
    });

    // clear route from map
    $('#clear-route').on('click', function(e) {
      e.preventDefault();
      if (map.hasLayer(routeLayer)) {
        // map.removeLayer(routeLayer);}
        routeLayer.clearLayers();}
      console.log("Finished remove routeLayer"); 
    });

    // experiment.
    $('#add-path').on('click', function(e) {
      e.preventDefault();
      $.get('/get_route_polyline', addPath);
      console.log("Finished add path");
    });

    // experiment.
    $('#remove-path').on('click', function(e) {
      e.preventDefault();
    });


    // commit to database about saved trip and clear session and waypoints list
    $('#clear-session').on('click', function(e){
      e.preventDefault();
      $('#waypoint-list').empty();
      console.log("Finished empty waypoint list");
      $('#selected-profile').empty();
      console.log("Finished empty profile");
      $.get('/start_over', showStatus);
      console.log("Finished show status");
    });

    // css position change
    // things within container width 100%
    // load geojson first, add to map later
    // Interview cake

</script>    
</body>
</html>